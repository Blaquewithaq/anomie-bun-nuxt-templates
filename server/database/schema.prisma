generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
  binaryTargets   = ["native", "darwin-arm64"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
  schemas   = ["app", "private", "public"]
}

//------------------------------------------------
// Schema: app
//------------------------------------------------

model Build {
  id                 String               @id @unique @default(uuid()) @db.Uuid
  codename           String               @unique
  changelog          String
  buildDate          String
  version            String               @unique
  createdAt          DateTime             @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime             @default(now()) @map("updated_at") @db.Timestamptz(6)
  client             Client[]
  linkBuildAndTarget LinkBuildAndTarget[]

  @@map("build")
  @@schema("app")
}

enum TargetPlatform {
  windows
  macos
  linux
  android
  ios
  web
  other

  @@map("target_platform")
  @@schema("app")
}

model Target {
  id                 String               @id @unique @default(uuid()) @db.Uuid
  name               String               @unique
  description        String
  platform           TargetPlatform
  createdAt          DateTime             @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime             @default(now()) @map("updated_at") @db.Timestamptz(6)
  client             Client[]
  linkBuildAndTarget LinkBuildAndTarget[]

  @@map("target")
  @@schema("app")
}

model ClientData {
  id                            String   @id @unique @db.Uuid
  browserPropertiesAllowCollect Boolean  @default(true) @map("browser_properties_allow_collect")
  browserProperties             Json?    @map("browser_properties")
  createdAt                     DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                     DateTime @default(now()) @map("updated_at") @db.Timestamptz(6)
  client                        Client   @relation(fields: [id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("client_data")
  @@schema("app")
}

model Client {
  id         String      @id @unique @default(uuid()) @db.Uuid
  online     Boolean     @default(false)
  lastOnline DateTime    @default(now()) @map("last_online") @db.Timestamptz(6)
  disabled   Boolean     @default(false)
  buildId    String      @map("build_id") @db.Uuid
  targetId   String      @map("target_id") @db.Uuid
  createdAt  DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime    @default(now()) @map("updated_at") @db.Timestamptz(6)
  build      Build       @relation(fields: [buildId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  target     Target      @relation(fields: [targetId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  data       ClientData?

  @@map("client")
  @@schema("app")
}

model LinkBuildAndTarget {
  buildId   String   @map("build_id") @db.Uuid
  targetId  String   @map("target_id") @db.Uuid
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @default(now()) @map("updated_at") @db.Timestamptz(6)
  build     Build    @relation(fields: [buildId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  target    Target   @relation(fields: [targetId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([buildId, targetId])
  @@map("link_build_and_target")
  @@schema("app")
}

//------------------------------------------------
// Schema: private
//------------------------------------------------

enum AccountRole {
  admin
  user
  beta
  tester

  @@map("account_role")
  @@schema("private")
}

model Account {
  id        String      @id @unique @default(uuid()) @db.Uuid
  email     String      @unique
  phone     String?     @unique
  role      AccountRole @default(user)
  verified  Boolean     @default(false)
  banned    Boolean     @default(false)
  profile   Profile?
  createdAt DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime    @default(now()) @map("updated_at") @db.Timestamptz(6)

  @@map("account")
  @@schema("private")
}

//------------------------------------------------
// Schema: public
//------------------------------------------------

model Profile {
  id        String   @id @unique @default(uuid()) @db.Uuid
  username  String   @unique
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @default(now()) @map("updated_at") @db.Timestamptz(6)
  account   Account  @relation(fields: [id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("profile")
  @@schema("public")
}
